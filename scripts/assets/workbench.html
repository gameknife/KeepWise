<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KeepWise M1 工作台</title>
  <link rel="stylesheet" href="/assets/workbench.css">
</head>
<body>
  <div class="container">
    <section class="hero">
      <h1>KeepWise M1 工作台</h1>
      <p>主线：投资记录维护、区间收益率（现金加权）、财富总览、增长曲线。</p>
      <div class="hero-actions">
        <label class="privacy-toggle" for="privacyToggle">
          <input id="privacyToggle" type="checkbox">
          隐私截图模式（隐藏金额）
        </label>
      </div>
      <div class="tabs">
        <button class="tab-btn active" data-tab="tab-import">导入中心</button>
        <button class="tab-btn" data-tab="tab-records">记录录入</button>
        <button class="tab-btn" data-tab="tab-return">收益分析</button>
        <button class="tab-btn" data-tab="tab-wealth">财富总览</button>
        <button class="tab-btn" data-tab="tab-budget">预算与FIRE</button>
        <button class="tab-btn" data-tab="tab-income">收入分析</button>
        <button class="tab-btn" data-tab="tab-consumption">消费分析</button>
        <button class="tab-btn" data-tab="tab-query">基础查询</button>
        <button class="tab-btn" data-tab="tab-admin">高级管理</button>
      </div>
    </section>

    <section id="tab-import" class="panel">
      <h2>导入中心</h2>
      <p class="hint">先预览再确认导入。支持 EML、多资产文件，以及招商银行银行流水 PDF（补充房贷/借记卡消费/工资）。</p>

      <h3>EML 导入</h3>
      <div class="row">
        <div>
          <label>选择 EML 文件（可多选）</label>
          <input id="emlFiles" type="file" multiple accept=".eml">
        </div>
        <div>
          <label>review_threshold</label>
          <input id="emlThreshold" type="number" step="0.01" min="0" max="1" value="0.70">
        </div>
      </div>
      <div class="actions">
        <button id="emlPreviewBtn" class="btn secondary">预览 EML</button>
        <button id="emlImportBtn" class="btn primary">确认导入 EML</button>
      </div>
      <div id="emlStatus" class="status hidden"></div>
      <div id="emlMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="emlErrorsWrap">
        <table>
          <thead><tr><th>错误文件</th><th>错误内容</th></tr></thead>
          <tbody id="emlErrorsBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:16px">有知有行导出表（CSV / XLSX）</h3>
      <div class="row">
        <div>
          <label>选择导出文件</label>
          <input id="yzxyCsvFile" type="file" accept=".csv,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/csv">
        </div>
        <div></div>
      </div>
      <div class="actions">
        <button id="yzxyPreviewBtn" class="btn secondary">预览文件</button>
        <button id="yzxyImportBtn" class="btn primary">确认导入文件</button>
      </div>
      <div id="yzxyStatus" class="status hidden"></div>
      <div id="yzxyMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="yzxyErrorsWrap">
        <table>
          <thead><tr><th>错误信息</th></tr></thead>
          <tbody id="yzxyErrorsBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:16px">招商银行银行流水 PDF（补充消费/收入）</h3>
      <div class="row">
        <div>
          <label>选择流水 PDF 文件</label>
          <input id="cmbBankPdfFile" type="file" accept=".pdf,application/pdf">
        </div>
        <div></div>
      </div>
      <div class="actions">
        <button id="cmbBankPdfPreviewBtn" class="btn secondary">预览 PDF</button>
        <button id="cmbBankPdfImportBtn" class="btn primary">确认导入 PDF</button>
      </div>
      <div id="cmbBankPdfStatus" class="status hidden"></div>
      <div id="cmbBankPdfMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="cmbBankPdfSamplesWrap">
        <table>
          <thead><tr><th>样本类型</th><th>日期</th><th>金额</th><th>对手信息</th></tr></thead>
          <tbody id="cmbBankPdfSamplesBody"></tbody>
        </table>
      </div>
    </section>

    <section id="tab-records" class="panel hidden">
      <h2>记录录入</h2>
      <p class="hint">金额单位为元，系统自动转换为分。</p>

      <div class="split-grid">
        <div class="sub-panel">
          <h3>投资记录单条录入</h3>
          <div class="row-3">
            <div>
              <label>投资账户</label>
              <select id="invAccountId">
                <option value="">请先创建投资账户</option>
              </select>
            </div>
            <div>
              <label>快照日期</label>
              <input id="invSnapshotDate" type="date">
            </div>
            <div>
              <label>总资产（元）</label>
              <input id="invTotalAssets" type="number" step="0.01">
            </div>
            <div>
              <label>转入转出金额（元）</label>
              <input id="invTransferAmount" type="number" step="0.01" value="0">
            </div>
          </div>
          <div class="actions">
            <button id="invSaveBtn" class="btn primary">保存投资记录</button>
            <button id="invCancelEditBtn" class="btn secondary hidden" type="button">取消编辑</button>
          </div>
          <div id="invEditHint" class="hint hidden" style="margin-top:8px">当前为编辑模式</div>
          <div id="invStatus" class="status hidden"></div>
        </div>

        <div class="sub-panel">
          <h3>现金/不动产/负债记录录入</h3>
          <div class="row-3">
            <div>
              <label>资产类型</label>
              <select id="assetClass">
                <option value="cash">现金账户</option>
                <option value="real_estate">不动产账户</option>
                <option value="liability">负债账户</option>
              </select>
            </div>
            <div>
              <label>账户</label>
              <select id="assetAccountId">
                <option value="">请先创建账户</option>
              </select>
            </div>
            <div>
              <label>快照日期</label>
              <input id="assetSnapshotDate" type="date">
            </div>
            <div>
              <label>快照金额（元）</label>
              <input id="assetValue" type="number" step="0.01">
            </div>
          </div>
          <div class="actions">
            <button id="assetSaveBtn" class="btn primary">保存资产记录</button>
            <button id="assetCancelEditBtn" class="btn secondary hidden" type="button">取消编辑</button>
          </div>
          <div id="assetEditHint" class="hint hidden" style="margin-top:8px">当前为编辑模式</div>
          <div id="assetStatus" class="status hidden"></div>
        </div>
      </div>
    </section>

    <section id="tab-return" class="panel hidden">
      <h2>收益分析（现金加权）</h2>
      <p class="hint">公式：Modified Dietz。支持 YTD、近一年、近三年、成立以来、自定义区间。</p>

      <div class="row-4">
        <div>
          <label>投资账户</label>
          <select id="retAccountId"></select>
        </div>
        <div>
          <label>区间预设</label>
          <select id="retPreset">
            <option value="ytd">年度（YTD）</option>
            <option value="1y" selected>近一年</option>
            <option value="3y">近三年</option>
            <option value="since_inception">成立以来</option>
            <option value="custom">自定义</option>
          </select>
        </div>
        <div>
          <label>开始日期（custom）</label>
          <input id="retFrom" type="date">
        </div>
        <div>
          <label>结束日期（可选）</label>
          <input id="retTo" type="date">
        </div>
      </div>
      <div class="actions">
        <button id="retRefreshAccountsBtn" class="btn secondary">刷新账户列表</button>
        <button id="retBatchBtn" class="btn secondary">计算全部账户收益率</button>
      </div>
      <div id="retStatus" class="status hidden"></div>
      <div id="retMetrics" class="grid-metrics hidden"></div>

      <div class="pill-tabs" id="retChartTabs">
        <button class="pill-tab active" data-view="asset">总资产曲线</button>
        <button class="pill-tab" data-view="return">累计收益率曲线</button>
        <button class="pill-tab" data-view="growth">净增长资金曲线</button>
      </div>

      <div id="retChartAssetView" class="chart-card">
        <div class="chart-header">投资账户总资产曲线</div>
        <div id="retCurveLegend" class="legend hidden"></div>
        <div id="retCurveChart" class="chart-host"></div>
      </div>

      <div id="retChartReturnView" class="chart-card hidden">
        <div class="chart-header">区间累计收益率曲线（现金加权）</div>
        <div id="retRateLegend" class="legend hidden"></div>
        <div id="retRateChart" class="chart-host"></div>
      </div>

      <div id="retChartGrowthView" class="chart-card hidden">
        <div class="chart-header">区间净增长资金曲线</div>
        <div id="retGrowthLegend" class="legend hidden"></div>
        <div id="retGrowthChart" class="chart-host"></div>
      </div>

      <div class="table-wrap hidden" id="retFlowWrap">
        <table>
          <thead>
            <tr><th>日期</th><th>转入转出(元)</th><th>权重</th></tr>
          </thead>
          <tbody id="retFlowBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:16px">账户收益率对比（同一区间）</h3>
      <div id="retBatchMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="retBatchWrap">
        <table>
          <thead>
            <tr>
              <th>账户</th>
              <th>区间收益率</th>
              <th>年化收益率</th>
              <th>收益额(元)</th>
              <th>净流入(元)</th>
              <th>区间</th>
              <th>有效天数</th>
            </tr>
          </thead>
          <tbody id="retBatchBody"></tbody>
        </table>
      </div>
    </section>

    <section id="tab-wealth" class="panel hidden">
      <h2>财富总览</h2>
      <p class="hint">按投资、现金、不动产、负债聚合展示资产趋势与结构关系。</p>

      <div class="pill-tabs" id="wealthAssetFilters">
        <button type="button" class="pill-tab active" data-key="include_investment" aria-pressed="true">投资</button>
        <button type="button" class="pill-tab active" data-key="include_cash" aria-pressed="true">现金</button>
        <button type="button" class="pill-tab active" data-key="include_real_estate" aria-pressed="true">不动产</button>
        <button type="button" class="pill-tab active" data-key="include_liability" aria-pressed="true">负债</button>
      </div>

      <div class="row">
        <div>
          <label>趋势区间</label>
          <select id="wealthCurvePreset">
            <option value="since_inception">成立以来</option>
            <option value="1y">近一年</option>
            <option value="ytd">YTD（今年以来）</option>
          </select>
        </div>
        <div></div>
      </div>

      <div id="wealthStatus" class="status hidden"></div>

      <h3 style="margin-top:16px">资产趋势</h3>
      <div id="wealthChartAssetView" class="chart-card">
        <div class="chart-header">资产趋势（堆叠）+ 总资产</div>
        <div id="wealthCurveLegend" class="legend hidden"></div>
        <div id="wealthCurveChart" class="chart-host"></div>
      </div>
      <div id="wealthChartGrowthView" class="chart-card">
        <div class="chart-header">资产 - 负债 - 净资产关系（Sankey）</div>
        <div id="wealthGrowthLegend" class="legend hidden"></div>
        <div id="wealthGrowthChart" class="chart-host"></div>
      </div>
    </section>

    <section id="tab-budget" class="panel hidden">
      <h2>预算与 FIRE 进度</h2>
      <p class="hint">低心智负担方案：维护少量平均月度支出预算项，系统自动折算年度预算，并对比实际消费与财务自由度。</p>

      <div class="split-grid">
        <div class="sub-panel">
          <h3>平均月度支出预算项</h3>
          <div class="row-4">
            <div>
              <label>项目名称</label>
              <input id="budgetItemName" type="text" placeholder="例如：房贷">
            </div>
            <div>
              <label>月度预算（元）</label>
              <input id="budgetItemMonthlyAmount" type="number" step="0.01" min="0" value="0">
            </div>
            <div>
              <label>排序</label>
              <input id="budgetItemSortOrder" type="number" step="1" value="1000">
            </div>
            <div>
              <label>状态</label>
              <select id="budgetItemIsActive">
                <option value="true" selected>启用</option>
                <option value="false">停用</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div>
              <label>编辑中的预算项 ID</label>
              <div id="budgetItemEditingId" class="metric" style="padding:9px 11px">-</div>
            </div>
            <div></div>
          </div>
          <div class="actions">
            <button id="budgetItemSaveBtn" class="btn primary">保存预算项</button>
            <button id="budgetItemCancelEditBtn" class="btn secondary hidden" type="button">取消编辑</button>
            <button id="budgetItemRefreshBtn" class="btn secondary" type="button">刷新预算项</button>
          </div>
          <div id="budgetItemEditHint" class="hint hidden" style="margin-top:8px">当前为编辑模式</div>
          <div id="budgetItemsStatus" class="status hidden"></div>
          <div id="budgetItemsMetrics" class="grid-metrics hidden"></div>

          <div class="table-wrap hidden" id="budgetItemsWrap">
            <table>
              <thead>
                <tr><th>项目</th><th>月度预算(元)</th><th>年度预算(元)</th><th>状态</th><th>来源</th><th>操作</th></tr>
              </thead>
              <tbody id="budgetItemsBody"></tbody>
            </table>
          </div>
        </div>

        <div class="sub-panel">
          <h3>预算总览与财务自由度</h3>
          <div class="row-3">
            <div>
              <label>预算年度</label>
              <input id="budgetYear" type="number" min="2000" max="2100" step="1">
            </div>
            <div>
              <label>提取率（%）</label>
              <input id="budgetWithdrawalRatePct" type="number" min="0.01" max="99.99" step="0.01" value="4.00">
            </div>
            <div></div>
          </div>
          <div class="actions">
            <button id="budgetRefreshBtn" class="btn primary" type="button">刷新预算/FIRE指标</button>
          </div>
          <div id="budgetStatus" class="status hidden"></div>

          <h4 style="margin-top:12px">预算总览</h4>
          <div id="budgetSummaryMetrics" class="grid-metrics hidden"></div>

          <h4 style="margin-top:12px">FIRE 进度</h4>
          <div id="fireMetrics" class="grid-metrics hidden"></div>

          <h4 style="margin-top:12px">月度复盘（总额）</h4>
          <div id="budgetMonthlyReviewMetrics" class="grid-metrics hidden"></div>
          <div class="table-wrap hidden" id="budgetMonthlyReviewWrap">
            <table>
              <thead>
                <tr><th>月份</th><th>预算(元)</th><th>实际消费(元)</th><th>差额(元)</th><th>达成率</th><th>笔数</th><th>状态</th></tr>
              </thead>
              <tbody id="budgetMonthlyReviewBody"></tbody>
            </table>
          </div>

          <p class="hint" style="margin-top:12px">
            实际消费口径默认排除待确认交易与排除统计交易；财务自由度口径使用「投资 + 现金」，默认提取率 4%。
          </p>
        </div>
      </div>
    </section>

    <section id="tab-income" class="panel hidden">
      <h2>收入分析（工资 / 公积金）</h2>
      <p class="hint">基于招商银行银行流水 PDF 导入结果，展示工资与公积金收入的年内汇总、月度分布与工资来源。</p>

      <div class="row-3">
        <div>
          <label>统计年度</label>
          <input id="incomeYear" type="number" min="2000" max="2100" step="1">
        </div>
        <div></div>
        <div></div>
      </div>
      <div class="actions">
        <button id="incomeRefreshBtn" class="btn primary" type="button">刷新收入分析</button>
      </div>

      <div id="incomeStatus" class="status hidden"></div>
      <div id="incomeMetrics" class="grid-metrics hidden"></div>

      <h3 style="margin-top:14px">月度收入（工资 / 公积金）</h3>
      <div class="table-wrap hidden" id="incomeMonthlyWrap">
        <table>
          <thead>
            <tr>
              <th>月份</th>
              <th>工资(元)</th>
              <th>工资笔数</th>
              <th>公积金(元)</th>
              <th>公积金笔数</th>
              <th>合计收入(元)</th>
            </tr>
          </thead>
          <tbody id="incomeMonthlyBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:14px">工资来源（雇主）</h3>
      <div class="table-wrap hidden" id="incomeEmployerWrap">
        <table>
          <thead>
            <tr><th>雇主</th><th>工资收入(元)</th><th>笔数</th></tr>
          </thead>
          <tbody id="incomeEmployerBody"></tbody>
        </table>
      </div>
    </section>

    <section id="tab-consumption" class="panel hidden">
      <h2>消费分析</h2>
      <p class="hint">整合旧版消费分析交互（筛选/图表/排序）。统计粒度以“年度”为上限，支持按月份细看。</p>
      <div class="actions">
        <button id="consumptionFrameReloadBtn" class="btn secondary" type="button">刷新消费分析</button>
        <a class="btn ghost" href="/rules" rel="noopener">交易规则管理</a>
      </div>
      <iframe
        id="consumptionFrame"
        title="消费分析"
        loading="lazy"
        src="/consumption"
        style="width:100%; min-height:1600px; border:1px solid var(--line, #dce5df); border-radius:14px; background:#fff;"
      ></iframe>
    </section>

    <section id="tab-query" class="panel hidden">
      <h2>基础查询</h2>
      <p class="hint">提供交易、投资、非投资资产记录的筛选与列表。</p>

      <h3>账户管理</h3>
      <p class="hint">手动创建账户后，记录录入与查询会自动使用下拉菜单展示。</p>
      <div class="sub-panel">
        <div class="row-4">
          <div>
            <label>账户类型</label>
            <select id="acctKind">
              <option value="investment">投资</option>
              <option value="cash">现金</option>
              <option value="real_estate">不动产</option>
              <option value="bank">银行卡</option>
              <option value="credit_card">信用卡</option>
              <option value="wallet">钱包</option>
              <option value="liability">负债</option>
              <option value="other">其他</option>
            </select>
          </div>
          <div>
            <label>账户名称</label>
            <input id="acctName" type="text" placeholder="例如：富途主账户">
          </div>
          <div>
            <label>编辑中的账户 ID</label>
            <div id="acctEditingId" class="metric" style="padding:9px 11px">-</div>
          </div>
          <div></div>
        </div>
        <div class="actions">
          <button id="acctSaveBtn" class="btn primary">创建账户</button>
          <button id="acctCancelEditBtn" class="btn secondary hidden" type="button">取消编辑</button>
          <button id="acctRefreshBtn" class="btn secondary" type="button">刷新账户列表</button>
        </div>
        <div id="acctEditHint" class="hint hidden" style="margin-top:8px">当前为账户编辑模式</div>
        <div id="acctStatus" class="status hidden"></div>
      </div>
      <div class="row-3" style="margin-top:12px">
        <div>
          <label>筛选类型</label>
          <select id="acctFilterKind">
            <option value="all">全部</option>
            <option value="investment">投资</option>
            <option value="cash">现金</option>
            <option value="real_estate">不动产</option>
            <option value="bank">银行卡</option>
            <option value="credit_card">信用卡</option>
            <option value="wallet">钱包</option>
            <option value="liability">负债</option>
            <option value="other">其他</option>
          </select>
        </div>
        <div>
          <label>关键词（名称/ID）</label>
          <input id="acctKeyword" type="text" placeholder="搜索账户">
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="actions" style="margin-top:0">
            <button id="acctFilterBtn" class="btn secondary" type="button">应用筛选</button>
            <button id="acctClearFilterBtn" class="btn secondary" type="button">清空筛选</button>
          </div>
        </div>
      </div>
      <div id="acctMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="acctWrap">
        <table>
          <thead>
            <tr>
              <th>类型</th>
              <th>账户名称</th>
              <th>账户 ID</th>
              <th>交易</th>
              <th>投资</th>
              <th>资产</th>
              <th>更新时间</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="acctBody"></tbody>
        </table>
      </div>

      <h3>交易查询</h3>
      <div class="row-3">
        <div><label>月份（YYYY-MM）</label><input id="qMonthKey" type="text" placeholder="2025-01"></div>
        <div><label>来源</label><input id="qTxSourceType" type="text" placeholder="cmb_eml"></div>
        <div>
          <label>账户</label>
          <select id="qTxAccountId">
            <option value="">全部账户</option>
          </select>
        </div>
        <div><label>关键词</label><input id="qTxKeyword" type="text"></div>
        <div>
          <label>排序</label>
          <select id="qTxSort">
            <option value="date_desc">按日期（新到旧）</option>
            <option value="amount_desc">按金额（绝对值降序）</option>
            <option value="amount_asc">按金额（绝对值升序）</option>
            <option value="date_asc">按日期（旧到新）</option>
          </select>
        </div>
        <div><label>limit</label><input id="qTxLimit" type="number" value="100"></div>
      </div>
      <div class="actions">
        <button id="qTxBtn" class="btn secondary">查询交易</button>
      </div>
      <div id="qTxMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="qTxWrap">
        <table>
          <thead><tr><th>日期</th><th>商户</th><th>摘要</th><th>金额(元)</th><th>分类</th><th>来源</th><th>统计状态</th><th>操作</th></tr></thead>
          <tbody id="qTxBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:16px">投资记录查询</h3>
      <div class="row-3">
        <div><label>开始日期</label><input id="qInvFrom" type="date"></div>
        <div><label>结束日期</label><input id="qInvTo" type="date"></div>
        <div><label>来源</label><input id="qInvSourceType" type="text" placeholder="manual"></div>
        <div>
          <label>投资账户</label>
          <select id="qInvAccountId">
            <option value="">全部投资账户</option>
          </select>
        </div>
        <div><label>limit</label><input id="qInvLimit" type="number" value="100"></div>
      </div>
      <div class="actions">
        <button id="qInvBtn" class="btn secondary">查询投资记录</button>
      </div>
      <div id="qInvMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="qInvWrap">
        <table>
          <thead><tr><th>日期</th><th>账户</th><th>总资产(元)</th><th>转入转出(元)</th><th>来源</th><th>操作</th></tr></thead>
          <tbody id="qInvBody"></tbody>
        </table>
      </div>

      <h3 style="margin-top:16px">现金/不动产/负债记录查询</h3>
      <div class="row-3">
        <div><label>开始日期</label><input id="qAssetFrom" type="date"></div>
        <div><label>结束日期</label><input id="qAssetTo" type="date"></div>
        <div>
          <label>资产类型</label>
          <select id="qAssetClass">
            <option value="">全部</option>
            <option value="cash">现金</option>
            <option value="real_estate">不动产</option>
            <option value="liability">负债</option>
          </select>
        </div>
        <div>
          <label>账户</label>
          <select id="qAssetAccountId">
            <option value="">全部资产账户</option>
          </select>
        </div>
        <div><label>limit</label><input id="qAssetLimit" type="number" value="100"></div>
      </div>
      <div class="actions">
        <button id="qAssetBtn" class="btn secondary">查询资产/负债记录</button>
      </div>
      <div id="qAssetMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="qAssetWrap">
        <table>
          <thead><tr><th>日期</th><th>类型</th><th>账户</th><th>金额(元)</th><th>来源</th><th>操作</th></tr></thead>
          <tbody id="qAssetBody"></tbody>
        </table>
      </div>
    </section>

    <section id="tab-admin" class="panel hidden">
      <h2>高级管理</h2>
      <p class="hint">用于开发验证：清空数据库后重新导入，验证流程可重复执行。</p>
      <div class="admin-warning">
        <strong>危险操作：</strong>会删除数据库中的全部业务数据（交易、投资、资产、导入任务、账户等），结构和索引会保留。
      </div>

      <div class="row-3" style="margin-top:10px">
        <div>
          <label>确认口令</label>
          <input id="adminConfirmText" type="text" placeholder="请输入确认口令">
        </div>
        <div>
          <label>系统口令</label>
          <div id="adminConfirmPhrase" class="metric" style="padding:9px 11px">-</div>
        </div>
        <div></div>
      </div>

      <div class="actions">
        <button id="adminLoadStatsBtn" class="btn secondary">查看数据库数据量</button>
        <button id="adminResetTxBtn" class="btn danger">仅清理交易数据（EML/PDF）</button>
        <button id="adminResetDbBtn" class="btn danger">清空全部数据库数据</button>
      </div>
      <p class="hint">“仅清理交易数据”会清空交易流水、对账记录，以及交易相关导入任务（`cmb_eml` / `cmb_bank_pdf`），不会影响投资/资产/预算数据。</p>
      <div id="adminStatus" class="status hidden"></div>
      <div id="adminMetrics" class="grid-metrics hidden"></div>
      <div class="table-wrap hidden" id="adminRowsWrap">
        <table>
          <thead><tr><th>表名</th><th>清理前</th><th>清理后</th><th>删除行数</th></tr></thead>
          <tbody id="adminRowsBody"></tbody>
        </table>
      </div>
      <h3 style="margin-top:18px">交易规则管理</h3>
      <p class="hint">规则编辑已拆分到独立页面，便于集中维护和查看。</p>
      <div class="actions">
        <a class="btn secondary" href="/rules" target="_blank" rel="noopener">打开交易规则管理页面</a>
      </div>
    </section>
  </div>

  <script src="/assets/workbench_shared.js"></script>
  <script src="/assets/workbench_consumption_embed.js"></script>
  <script src="/assets/workbench_account_catalog_shared.js"></script>
  <script src="/assets/workbench_chart_line.js"></script>
  <script src="/assets/workbench_chart_wealth_trend.js"></script>
  <script src="/assets/workbench_chart_wealth_sankey.js"></script>
  <script src="/assets/workbench_import_actions.js"></script>
  <script src="/assets/workbench_record_actions.js"></script>
  <script src="/assets/workbench_analytics_filter_helpers.js"></script>
  <script src="/assets/workbench_returns.js"></script>
  <script src="/assets/workbench_wealth.js"></script>
  <script src="/assets/workbench_budget.js"></script>
  <script src="/assets/workbench_income.js"></script>
  <script src="/assets/workbench_account_management.js"></script>
  <script src="/assets/workbench_query.js"></script>
  <script src="/assets/workbench_admin_bootstrap.js"></script>
</body>
</html>
