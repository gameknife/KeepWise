<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>消费分析（账本）</title>
  <link rel="stylesheet" href="/assets/consumption_report.css">
</head>
<body>
  <main class="shell">
    <section class="hero card">
      <div>
        <span class="badge">消费分析引擎 · 账本实时视图</span>
        <h1>消费分析报告</h1>
        <div class="muted" id="heroSubtitle">正在加载报告数据...</div>
      </div>
      <div class="hero-right">
        <button id="privacyToggle" class="privacy-toggle" type="button" aria-pressed="false" title="点击隐藏金额">
          <svg class="eye-icon icon-on" viewBox="0 0 24 24"><path d="M2 12s3.7-6 10-6 10 6 10 6-3.7 6-10 6-10-6-10-6z"/><circle cx="12" cy="12" r="3.2"/></svg>
          <svg class="eye-icon icon-off" viewBox="0 0 24 24"><path d="M2 12s3.7-6 10-6c2.2 0 4.1.7 5.7 1.6M22 12s-3.7 6-10 6c-2.2 0-4.1-.7-5.7-1.6"/><path d="M3 3l18 18"/></svg>
          <span id="privacyToggleLabel">隐藏金额</span>
        </button>
        <div class="links">
          <a class="link" href="/" rel="noopener">主工作台</a>
          <a class="link" href="/rules" rel="noopener">交易规则管理</a>
          <a class="link" href="/consumption" rel="noopener">刷新本页</a>
        </div>
      </div>
    </section>

    <section class="controls card">
      <div class="control">
        <label for="yearSelect">统计年份</label>
        <select id="yearSelect"></select>
      </div>
      <div class="control">
        <label for="monthSelect">账单月份</label>
        <select id="monthSelect"></select>
      </div>
      <div class="control">
        <label for="keywordInput">关键词（商户/摘要）</label>
        <input id="keywordInput" type="text" placeholder="例如：肯德基 / 盒马 / 停车">
      </div>
      <label class="control toggle">
        <input id="includePending" type="checkbox">
        显示待确认交易
      </label>
    </section>

    <section class="panel card">
      <h2>已选筛选</h2>
      <div id="filterPills" class="filter-pills"></div>
    </section>

    <section class="panel card">
      <div class="section-head">
        <h2>消费分类（可点击筛选）</h2>
        <div class="filter-actions">
          <button id="categorySelectAll" class="mini-btn" type="button">全选</button>
          <button id="categoryClear" class="mini-btn" type="button">清空</button>
        </div>
      </div>
      <div id="categoryCloud" class="merchant-cloud"></div>
    </section>

    <section class="metrics">
      <article class="metric card">
        <div class="metric-head">
          <svg viewBox="0 0 24 24"><path d="M3 12h18M3 7h18M3 17h18"/></svg>
          筛选后支出
        </div>
        <div id="metricTotal" class="metric-value">¥0.00</div>
        <div class="metric-sub" id="metricTotalSub">0 笔交易</div>
      </article>
      <article class="metric card">
        <div class="metric-head">
          <svg viewBox="0 0 24 24"><path d="M4 19h16M7 15l3-3 3 2 4-5"/></svg>
          单笔均额
        </div>
        <div id="metricAvg" class="metric-value">¥0.00</div>
        <div class="metric-sub">筛选范围内平均值</div>
      </article>
      <article class="metric card">
        <div class="metric-head">
          <svg viewBox="0 0 24 24"><path d="M12 3l8 4v5c0 5-3.4 8-8 9-4.6-1-8-4-8-9V7z"/></svg>
          待确认交易
        </div>
        <div id="metricReview" class="metric-value">0</div>
        <div class="metric-sub" id="metricReviewSub">0.00%</div>
      </article>
      <article class="metric card">
        <div class="metric-head">
          <svg viewBox="0 0 24 24"><path d="M5 5h14v14H5zM9 9h6v6H9z"/></svg>
          覆盖账单
        </div>
        <div id="metricFiles" class="metric-value">0</div>
        <div class="metric-sub" id="metricFilesSub">解析失败 0</div>
      </article>
    </section>

    <section class="grid-two">
      <article class="panel card">
        <h2>月度支出趋势</h2>
        <svg id="trendChart" viewBox="0 0 820 260" preserveAspectRatio="none"></svg>
      </article>
      <article class="panel card">
        <h2>分类占比结构</h2>
        <div class="donut-wrap">
          <div id="donut" class="donut"></div>
          <div id="donutLegend" class="legend"></div>
        </div>
      </article>
    </section>

    <section class="panel card">
      <h2>分类金额排行 <span class="muted" id="resultHint"></span></h2>
      <div id="categoryBars" class="bars"></div>
    </section>

    <section class="panel card">
      <h2>高频商户（可点击筛选）</h2>
      <div id="merchantCloud" class="merchant-cloud"></div>
    </section>

    <section class="panel card">
      <h2>交易明细（点击列头可正序/倒序）</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th><button class="th-sort" data-sort="date">日期 <span class="arrow"></span></button></th>
              <th><button class="th-sort" data-sort="category">分类 <span class="arrow"></span></button></th>
              <th><button class="th-sort" data-sort="merchant">商户 <span class="arrow"></span></button></th>
              <th><button class="th-sort" data-sort="description">摘要 <span class="arrow"></span></button></th>
              <th><button class="th-sort" data-sort="source_path">来源 <span class="arrow"></span></button></th>
              <th><button class="th-sort" data-sort="confidence">置信度 <span class="arrow"></span></button></th>
              <th class="num"><button class="th-sort" data-sort="amount">金额 <span class="arrow"></span></button></th>
            </tr>
          </thead>
          <tbody id="txnBody"></tbody>
        </table>
      </div>
      <div class="foot">
        <span id="footInfo">数据加载中</span>
        <span id="footTime">生成时间：-</span>
      </div>
    </section>
  </main>

  <script src="/assets/consumption_dashboard_shared.js"></script>
  <script src="/assets/consumption_dashboard_data.js"></script>
  <script src="/assets/consumption_dashboard_render.js"></script>
  <script src="/assets/consumption_dashboard_bootstrap.js"></script>
</body>
</html>
