# 本地版「有行体验」记账系统开发计划（Draft v0.1）

> 状态：规划中（本文件用于修订，不代表已开发）
>  
> 核心目标：做一款**本地优先、数据绝对可控**的个人资产与记账软件，兼顾舒适体验与账单核对精度。

## 1. 产品愿景

打造一个“本地版、有安全感、每天愿意打开”的记账与资产管理工具：

- 本地优先：个人财务数据默认仅保存在本机。
- 体验优先：借鉴《有行》的轻负担交互和审美，降低记账摩擦。
- 核对优先：结合信用卡账单自动导入与对账，提升准确性。
- 可扩展：从支出记账逐步扩展到资产、投资收益、预算与复盘。

## 2. 产品原则

- `Local First`：核心功能离线可用。
- `Privacy by Default`：默认隐藏敏感金额，导出前可脱敏。
- `Single Source of Truth`：导入账单 + 手工修正形成统一账本。
- `Automation with Confirmation`：自动分类可回溯，可人工确认。
- `Calm UX`：界面克制，关键操作少步骤、低认知负担。

## 3. 当前进度（已完成）

当前仓库已完成“支出盘点底座”：

- EML 账单解析、交易提取、分类规则、排除规则。
- 交互式 HTML 报告（筛选、排序、趋势、隐私开关）。
- 目录规范：`input / rules / output / work`。
- 一键执行：`./run_report.sh`。

这部分作为后续记账模块的数据输入与核对基础。

## 4. 最终形态（目标能力）

### 4.1 记账能力

- 手工记账（快速录入、模板、最近商户/分类记忆）。
- 自动导入（信用卡账单、后续可扩展更多来源）。
- 自动分类 + 待确认队列 + 批量修正。
- 多账户体系（银行卡/信用卡/现金/电子钱包）。

### 4.2 资产能力

- 资产总览（现金类、投资类、负债类）。
- 投资收益录入（先手工，后续可考虑半自动）。
- 净资产时间线、资产配置占比。

### 4.3 预算与核对能力

- 月度预算（分类预算、总预算、预警）。
- 实际支出 vs 预算偏差分析。
- 账单金额与账本核对（差异提示、漏记提醒）。

### 4.4 智能建议能力（后置）

- 基于交易、预算、资产、投资记录生成财务复盘建议。
- 提供可解释的投资与资金管理建议（含依据与风险提示）。
- 用于辅助决策，不替代用户判断。

## 5. 里程碑规划

## M0：产品与信息架构对齐（1 周）

输出物：

- 用户流程图（导入、记账、复盘）。
- 信息架构（页面与导航）。
- 数据字典初版（交易、账户、预算、资产）。

验收标准：

- 明确 MVP 范围与不做清单。
- 明确每个核心页面的输入/输出。

## M1：记账核心 MVP（2-3 周）

范围：

- 交易总账页（筛选、搜索、编辑）。
- 新增/编辑交易。
- 分类管理（含规则命中说明）。
- 本地数据库初始化与迁移。

验收标准：

- 不依赖网络可完整记账。
- 交易 CRUD 稳定，分类可回溯。

## M2：账单导入与对账（2 周）

范围：

- 复用现有 EML 解析能力接入应用层。
- “导入任务中心”：导入结果、异常、待确认。
- 对账页面：已匹配/未匹配/差异金额。

验收标准：

- 导入后可自动写入总账。
- 用户可在 UI 内完成待确认处理。

## M3：预算模块（1-2 周）

范围：

- 月度预算设置（总预算 + 分类预算）。
- 预算执行进度与超支预警。
- 预算复盘卡片（偏差原因记录）。

验收标准：

- 可按月追踪预算完成情况。
- 预算与实际支出一致可追溯。

## M4：资产与投资录入（2 周）

范围：

- 资产账户管理。
- 投资记录录入（按日期记录账户总资产 + 外部转入/外部转出）。
- 约束：仅支持外部出入金，不处理内部转账识别。
- 净资产总览与趋势。

验收标准：

- 可形成“收入-支出-资产”闭环视图。

## M5：体验与安全强化（持续）

范围：

- 交互细节打磨（快捷键、批量操作、空状态引导）。
- 数据备份/恢复（本地加密包）。
- 隐私与权限审计（导出脱敏、本地锁）。

验收标准：

- 新用户 10 分钟内可跑通“导入→分类→预算查看”。
- 本地备份恢复可成功还原。

## M6：解析引擎 Go 化（后置专项）

范围：

- 将现有账单解析能力从 Python 迁移到 Go。
- 保持现有分类/排除口径一致（回归对比）。
- 移除对 Python 运行环境的依赖。

验收标准：

- 同一批样本账单，关键统计差异在可接受范围内（需定义阈值）。
- 最终发布包仅需单个 Go 二进制即可运行。

## M7：Generative AI 决策建议（最终阶段）

范围：

- 接入本地账本与投资记录的分析层，生成“可解释建议”。
- 输出建议类型：现金流优化、预算调整、资产配置提醒、风险暴露提示。
- 建立建议安全边界：免责声明、置信度、建议依据可追溯。

验收标准：

- 每条建议都能回溯到具体数据依据（交易/预算/资产/投资记录）。
- 建议文本包含“不构成投资建议”声明与风险提示。
- 用户可对建议做反馈（有用/无用），用于后续迭代。

## 6. 技术方案（建议）

> 已确认方向（本次会话结论）

- 运行形态：`Go 单二进制` 启动本地 Web 服务，浏览器访问（`127.0.0.1`）。
- UI 路线：`轻前端`（优先原生/轻框架，避免重型前端栈）。
- 数据层：`SQLite`（后续可加密，如 `SQLCipher`）。
- 打包目标：用户开箱即用，不依赖 Python/Node 运行环境。
- 解析引擎：最终迁移到 Go；但**不立即执行**，先保障主链路可用。

技术取舍说明：

- `Electron` 体积与运行时负担偏大，不作为当前方案。
- `Tauri` 可作为未来可选封装层，但当前阶段不优先。
- 现阶段优先“可交付、可维护、低依赖”的本地 Web 方案。

建议优先级：

1. 先打通 Go 服务 + SQLite + 交易 CRUD。
2. 再接入账单导入与对账（先复用现有解析能力）。
3. 稳定后推进解析引擎 Go 化，移除 Python 依赖。

## 7. 数据模型草案（核心实体）

- `accounts`：账户信息（类型、币种、初始余额）。
- `transactions`：交易明细（金额、分类、商户、时间、来源、状态）。
- `categories`：分类树（层级、预算开关）。
- `import_jobs`：导入任务（来源、状态、日志、异常）。
- `reconciliations`：对账结果（匹配状态、差异）。
- `budgets`：预算（周期、分类、金额）。
- `assets`：资产快照（现金、投资、负债）。
- `investment_records`：投资收益记录。

### 7.0 投资记录口径约束（已确认）

- 资金流仅分两类：`external_in`、`external_out`。
- 当前版本不支持内部转账建模与识别。
- 投资收益计算基于“账户总资产快照 + 外部出入金”。

### 7.1 为后续 AI 建议预留的数据要求（前置约束）

- 交易数据需保留来源与可信度：
  - `source_type`、`source_file`、`import_job_id`、`confidence`、`needs_review`。
- 交易数据需可做时间序列分析：
  - `occurred_at`、`posted_at`、`month_key`、`account_id`、`category_id`。
- 投资记录需支持收益拆解：
  - 本金变动、现金分红、已实现收益、未实现浮盈亏。
- 预算与目标需结构化：
  - 周期、目标值、实际值、偏差值、偏差原因标签。
- AI 建议需可解释：
  - 保存“建议文本 + 依据数据引用 + 生成时间 + 版本号”。

## 8. 非功能需求

- 性能：1 万条交易内，主列表筛选与排序应流畅。
- 稳定性：导入异常不影响现有账本。
- 安全性：默认不上传，敏感信息可一键隐藏。
- 可维护性：规则、数据迁移、导入适配器可独立演进。
- 可分析性：核心数据字段完整、口径一致，可直接用于后续 AI 分析。

## 9. 风险与应对

- 风险：自动分类误判影响信任。
  - 应对：显示命中依据 + 一键修正 + 持续学习映射。
- 风险：导入格式变化导致解析失败。
  - 应对：导入任务日志 + 失败样本回放机制。
- 风险：功能增长过快导致体验变重。
  - 应对：坚持 MVP 分期，优先高频路径。
- 风险：AI 建议出现幻觉或误导。
  - 应对：仅做辅助建议；强制展示依据与风险提示；高风险场景不做自动决策。

## 10. 下次会话建议起步任务

1. 冻结 MVP 边界（M1 + M2 的最小可用范围）。
2. 明确 Go 本地 Web 项目的目录结构与模块边界。
3. 画 3 个核心页面线框：
   - 交易总账
   - 导入/对账
   - 预算首页
4. 定义 SQLite 初版表结构并建迁移脚本。
5. 设计“解析引擎迁移计划”（先兼容，后替换）。
6. 在表结构中预留 AI 分析所需字段（来源、置信度、时间序列、建议回溯）。

## 11. 版本记录

- `v0.1`：根据当前“支出盘点已完成”的基础，形成产品与研发里程碑初稿。
- `v0.2`：确认技术路线为 `Go 单二进制 + 本地 Web + 轻前端`，并确定解析引擎迁移到 Go 但延期执行。
- `v0.3`：新增“Generative AI 决策建议”为最终阶段目标，并补充前置数据设计约束。
